var CalendarComponent=(()=>{var b=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var N=(t,a)=>{for(var e in a)b(t,e,{get:a[e],enumerable:!0})},F=(t,a,e,s)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of Y(a))!O.call(t,n)&&n!==e&&b(t,n,{get:()=>a[n],enumerable:!(s=T(a,n))||s.enumerable});return t};var j=t=>F(b({},"__esModule",{value:!0}),t);var U={};N(U,{registerCalendar:()=>D});var _=`<div x-data="calendar_module" class="alpine-calendar-component"><div x-show="showControl"><button @click="changeAvailableDates" class="alpine-calendar-component__action-btn">Change availableDates</button><br><label for="selection-mode">Selection mode:</label><select x-model="selectMode" id="selection-mode"><option value="single" selected>Single</option><option value="multiple">Multiple</option></select><template x-if="!selectedEntry && selectedDates.length == 0"><p>Please select date.</p></template><template x-if="selectedDates.length > 0"><p> Selected dates: <strong><span x-text="selectedDates[0]"></span> ~ <span x-text="selectedDates[1]"></span></strong><button @click="selectEntry(null)" class="alpine-calendar-component__action-btn">Clear</button></p></template><template x-if="selectedEntry"><p> Selected date: <strong><span x-text="selectedDate"></span></strong><template x-if="selectedEntry?.isToday"><span>(Today!)</span></template><button @click="selectEntry(null)" class="alpine-calendar-component__action-btn">Clear</button></p></template><div class="alpine-calendar-component__jumper"><button @click="resetCalendar" class="alpine-calendar-component__jump-btn">Today</button><template x-for="(_, index) in Array(4).fill(null)" :key="index"><button @click="jumpToYearCurrentMonth(getToday().year+index)" x-text="getToday().year+index" class="alpine-calendar-component__jump-btn"></button></template></div></div><div x-data="calendar_entry" x-ref="calendarEntry" class="alpine-calendar-component__container"><template x-for="(g, k) in grids" :key="k"><table class="alpine-calendar-component__calendar"><thead><tr><th colspan="7"><div class="alpine-calendar-component__tools"><button @click="gotoPrevMonth()" class="alpine-calendar-component__tool-btn">&larr;</button><select x-model="years[k]" @change="gotoMonthYear(years[k], months[k], k)" class="alpine-calendar-component__select"><template x-for="(y, i) in getYearRange()" :key="i"><option :value="y" x-text="y" :selected="y == years[k]"></option></template></select><select x-model="months[k]" @change="gotoMonthYear(years[k], months[k], k)" class="alpine-calendar-component__select"><template x-for="(m, idx) in getAllMonths()" :key="idx"><option :value="idx" x-text="m" :selected="idx == months[k]"></option></template></select><button x-show="selectedEntry || selectedDates.length > 0" @click="selectEntry(null)" class="alpine-calendar-component__icon-btn" :disabled="!selectedEntry && selectedDates.length == 0">\u{1F9F9}</button><button @click="gotoNextMonth()" class="alpine-calendar-component__tool-btn">&rarr;</button></div></th></tr><tr><template x-for="header in g.headersAbbreviated" :key="header"><th scope="col" x-text="header"></th></template></tr></thead><tbody><template x-for="(week, i) in g.weeks" :key="i"><tr><template x-for="entry in week" :key="entry.id"><td><button @click="selectEntry(entry)" class="alpine-calendar-component__date-btn" :class="{ 'current': entry.isCurrentMonth, 'other': entry.isOtherMonth, 'today': entry.isToday, 'weekday': entry.isWeekday, 'saturday': entry.isSaturday, 'sunday': entry.isSunday, 'selected': isSelected(entry) }" :disabled="!getAvailable(entry)" x-text="entry.date"></button></td></template></tr></template></tbody></table></template></div></div>`;var k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],I=["Sun","Mon","Tue","Wed","Thr","Fri","Sat"],g=["January","February","March","April","May","June","July","August","September","October","November","December"],$=!0,A=!1;function w(t,a){let e=R(t,a),s=[];for(let n=1;n<=e;n++)s.push(v(t,a,n,$));return s}function v(t,a,e,s){let n=new Date(t,a,e);return{id:n.getTime(),year:n.getFullYear(),month:n.getMonth(),monthName:g[n.getMonth()],date:n.getDate(),day:n.getDay(),dayName:k[n.getDay()],isToday:H(n),isCurrentMonth:s,isOtherMonth:!s,isWeekday:J(n.getDay()),isSaturday:q(n.getDay()),isSunday:z(n.getDay())}}function M(t){let a={headers:k.slice(),headersAbbreviated:I.slice(),entries:t.slice(),weeks:[]};for(;;){let e=a.entries.at(0);if(L(e))break;a.entries.unshift(v(e.year,e.month,e.date-1,A))}for(;;){let e=a.entries.at(-1);if(W(e))break;a.entries.push(v(e.year,e.month,e.date+1,A))}for(let e=0;e<a.entries.length;e+=7)a.weeks.push(a.entries.slice(e,e+7));return a}function R(t,a){return new Date(t,a+1,0).getDate()}function L(t){return t.day==0}function W(t){return t.day==6}function H(t){let a=new Date;return t.getFullYear()==a.getFullYear()&&t.getMonth()==a.getMonth()&&t.getDate()==a.getDate()}function J(t){return!P(t)}function P(t){return t==0||t==6}function q(t){return t==6}function z(t){return t==0}function E(t,a,e){return a=(a+1).toString().padStart(2,"0"),e=e.toString().padStart(2,"0"),`${t}-${a}-${e}`}function C(t){return E(t.year,t.month,t.date)}var K=(t,a)=>{let e=1,s=new Date,n=t??s.getFullYear(),l=a??s.getMonth(),i=[],o=[],u=[],y=[];for(let r=0;r<e;r++){let c=new Date(n,l+r),d=c.getFullYear(),h=c.getMonth(),p=g[h];i.push(d),o.push(h),u.push(p);let f=w(d,h);y.push(M(f))}return{moreMonthCount:e,year:n,month:l,years:i,months:o,monthNames:u,grids:y,getAllMonths(){return g},getYearRange(){let r=new Date().getFullYear(),c=r-10,d=r+10,h=[];for(let p=c;p<=d;p++)h.push(p);return h},gotoMonthYear(r,c,d=0){let h=c-d;this.gotoDate(new Date(r,h,1))},gotoDate(r){this.year=r.getFullYear(),this.month=r.getMonth(),this.monthName=g[this.month],this.entries=w(this.year,this.month),this.grid=M(this.entries),this.years=[],this.months=[],this.monthNames=[],this.grids=[];for(let c=0;c<this.moreMonthCount;c++){let d=new Date(this.year,this.month+c),h=d.getFullYear(),p=d.getMonth(),f=g[p];this.years.push(h),this.months.push(p),this.monthNames.push(f);let x=w(h,p);this.grids.push(M(x))}},gotoNextMonth(){this.gotoDate(new Date(this.year,this.month+1,1))},gotoToday(){this.gotoDate(new Date)},gotoPrevMonth(){this.gotoDate(new Date(this.year,this.month-1,1))},gotoYear(r,c){this.gotoDate(new Date(r,c||0,1))}}},G=(t={})=>({showCalendarCount:t.showCalendarCount||1,selectMode:t.selectMode||"single",selectedEntry:null,selectedDate:null,selectedDates:[],availables:t.availableDates||[],showControl:t.showControl||!1,async init(){this.$watch("selectMode",()=>{this.clearSelection()}),this.availables[0]=="random"&&this.setAvailables(this.createRandomAvailableDates()),this.selectedDate=t.selectedDate||null,this.selectedDates=t.selectedDates||[],this.showCalendarCount>1&&(await this.$nextTick(),this.updateShowMonthCount(this.showCalendarCount))},createRandomAvailableDates(){let e=new Date,s=e.getFullYear(),n=e.getMonth(),l=new Date(s,n,1),i=new Date(s,n+2,0),o=[];for(let m=new Date(l);m<=i;m.setDate(m.getDate()+1)){let r=m.getFullYear(),c=String(m.getMonth()+1).padStart(2,"0"),d=String(m.getDate()).padStart(2,"0");o.push(`${r}-${c}-${d}`)}let u=[...o],y=Math.floor(Math.random()*(o.length/2));for(let m=0;m<y;m++){let r=Math.floor(Math.random()*u.length);u.splice(r,1)}return u},changeAvailableDates(){this.availables.length>0?this.setAvailables([]):this.setAvailables(this.createRandomAvailableDates()),this.clearSelection()},getToday(){let e=new Date,s=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return{year:s,month:n,date:l}},clearSelection(){this.selectedEntry=null,this.selectedDate=null,this.selectedDates=[]},setSelectMode(e){this.selectMode=e},updateShowMonthCount(e){e<=0&&(e=1),this.getCalendarDataObject().moreMonthCount=e,this.clearSelection(),this.jumpToYearCurrentMonth(this.getCalendarDataObject().year)},setAvailables(e){this.availables=e},getAvailable(e){if(!this.availables||this.availables.length==0)return!0;let s=e.year,n=(e.month+1).toString().padStart(2,"0"),l=e.date.toString().padStart(2,"0"),i=`${s}-${n}-${l}`;return this.availables.includes(i)},getCalendarDataObject(){return Alpine.$data(this.$root.querySelector("table"))},jumpToYear(e){this.getCalendarDataObject().gotoYear(e)},jumpToYearCurrentMonth(e){this.getCalendarDataObject().gotoYear(e,this.getCalendarDataObject().month)},resetCalendar(){this.getCalendarDataObject().gotoToday()},isSelected(e){let s=!1;switch(this.selectMode){case"single":s=this.selectedEntry?.id==e.id;break;case"multiple":let n=C(e);if(this.selectedDates.length==1)s=this.selectedDates.includes(n);else if(this.selectedDates.length==2){let l=this.selectedDates[0],i=this.selectedDates[1];for(let o=new Date(l);o<=new Date(i);o.setDate(o.getDate()+1)){let u=E(o.getFullYear(),o.getMonth(),o.getDate());if(n==u){s=!0;break}}}break}return s},selectEntry(e=null){switch(this.selectMode){case"single":if(e&&this.selectedEntry&&this.selectedEntry.id==e.id){this.selectedEntry=null;return}if(this.selectedEntry=e,this.selectedDate=null,this.selectedEntry&&(this.selectedDate=C(this.selectedEntry)),this.selectedDate){let i=this.$el.closest("my-calendar");i&&i.dispatchEvent(new CustomEvent("date-selected",{detail:{date:this.selectedDate}}))}break;case"multiple":if(e==null){this.selectedDates=[];return}let s,n,l=C(e);if(this.selectedDates.includes(l)){this.selectedDates=this.selectedDates.filter(i=>i!=l);return}if(this.selectedDates.length==1?(s=new Date(this.selectedDates[0]),new Date(l)<s?this.selectedDates.unshift(l):this.selectedDates.push(l)):this.selectedDates.length==2?(s=new Date(this.selectedDates[0]),new Date(l)<s?this.selectedDates[0]=l:this.selectedDates[1]=l):(this.selectedDates=[],this.selectedDates.push(l)),this.selectedDates.length>1){s=this.selectedDates[0],n=this.selectedDates[1];for(let o=new Date(s);o<=new Date(n);o.setDate(o.getDate()+1)){let u=E(o.getFullYear(),o.getMonth(),o.getDate());if(this.availables.length>0&&!this.availables.includes(u))return this.selectedDates=[],!1}let i=this.$el.closest("my-calendar");i&&i.dispatchEvent(new CustomEvent("dates-selected",{detail:{startDate:this.selectedDates[0],endDate:this.selectedDates[1]}}))}break}},getSelection(){let e=null;switch(this.selectMode){case"single":e=this.selectedEntry;break;case"multiple":e=this.selectedDates;break}return e}});function D(t={}){return window.Alpine?(window.Alpine.data("calendar_entry",K),window.Alpine.data("calendar_module",()=>G(t)),{mount(e){typeof e=="string"&&(e=document.querySelector(e)),e||console.error("Cannot find target element.",e),e.innerHTML=_},getTemplate(){return _}}):(console.error("Alpine.js is not loaded. Please load Alpine.js first."),null)}var S=class extends HTMLElement{constructor(){super(),this._config={showCalendarCount:1,selectMode:"single",availableDates:[],selectedDate:null,selectedDates:[]}}static get observedAttributes(){return["show-calendar-count","select-mode","available-dates","config"]}attributeChangedCallback(a,e,s){if(e!==s){switch(a){case"show-calendar-count":this._config.showCalendarCount=parseInt(s,10)||1;break;case"select-mode":this._config.selectMode=s||"single";break;case"available-dates":try{this._config.availableDates=JSON.parse(s)||[]}catch(n){console.error("Invalid available-dates attribute:",n),this._config.availableDates=[]}break;case"config":try{let n=JSON.parse(s);this._config={...this._config,...n}}catch(n){console.error("Invalid config attribute:",n)}break}this.isConnected&&this._updateCalendar()}}connectedCallback(){let a=this.getAttribute("show-calendar-count"),e=this.getAttribute("select-mode"),s=this.getAttribute("available-dates"),n=this.getAttribute("config");if(a&&(this._config.showCalendarCount=parseInt(a,10)||1),e&&(this._config.selectMode=e),s)try{this._config.availableDates=JSON.parse(s)||[]}catch(l){console.error("Invalid available-dates attribute:",l)}if(n)try{let l=JSON.parse(n);this._config={...this._config,...l}}catch(l){console.error("Invalid config attribute:",l)}this._waitForAlpineAndMount()}_waitForAlpineAndMount(){window.Alpine&&window.Alpine.version?this._mountCalendar():(console.log("Waiting for Alpine.js to initialize..."),window.addEventListener("alpine:initialized",()=>{console.log("Alpine:initialized event detected"),this._mountCalendar()},{once:!0}),setTimeout(()=>{!this._mounted&&window.Alpine&&(console.log("Mounting calendar after timeout"),this._mountCalendar())},500))}_mountCalendar(){if(!this._mounted){if(!window.Alpine){console.error("Alpine.js is not loaded. Please load Alpine.js first.");return}this._mounted=!0;try{let a=D(this._config);a?(a.mount(this),setTimeout(()=>{this._setupDateSelectionListeners()},150)):console.error("Failed to register calendar")}catch(a){console.error("Error mounting calendar:",a)}}}_updateCalendar(){!this._mounted||!window.Alpine||(this.innerHTML="",this._mounted=!1,this._mountCalendar())}_setupDateSelectionListeners(){try{let a=this.querySelector('[x-data="calendar_module"]');if(a&&a.__x){console.log("Found calendar module element");let e=a.__x.$data,s=e.selectEntry;e.selectEntry=(n=null)=>{s.call(e,n),e.selectMode==="single"&&e.selectedDate&&this.dispatchEvent(new CustomEvent("date-selected",{detail:{date:e.selectedDate}})),e.selectMode==="multiple"&&e.selectedDates.length===2&&this.dispatchEvent(new CustomEvent("dates-selected",{detail:{startDate:e.selectedDates[0],endDate:e.selectedDates[1]}}))},console.log("Selection listeners setup complete")}}catch(a){console.warn("Error setting up date selection listeners:",a)}}};customElements.get("my-calendar")||customElements.define("my-calendar",S);typeof document<"u"&&document.addEventListener("DOMContentLoaded",()=>{window.Alpine&&document.querySelectorAll("[data-calendar-mount]").forEach(t=>{let a={showCalendarCount:parseInt(t.dataset.calendarCount||"1",10),selectMode:t.dataset.calendarSelectMode||"single",availableDates:t.dataset.calendarAvailableDates?JSON.parse(t.dataset.calendarAvailableDates):[]},e=D(a);e&&e.mount(t)})});window.CalendarComponent={registerCalendar:D};return j(U);})();
